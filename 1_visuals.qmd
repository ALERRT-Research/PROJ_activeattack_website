---
#title: "The Anatomy of Active Attacks in the USA, 2000-2023"
format: 
  dashboard: 
    orientation: rows
    scrolling: true
resources: 
  - "www/"
---

```{r, packages_data_fns}
#| echo: false
#| include: false

#load packages
source("0_set_up.R")

#import data
aa_data <- import("data/aa_data_wide_nogeo_2023.rds", trust=TRUE)
aa_data_long <- import("data/aa_data_long_nogeo_2023.rds", trust=TRUE)

```

# Timing 

## row 1

### row 1, column 1 {width="40%"}

```{r, r_objs_yr}
#| include: false
#| echo: false

#years in dataset
years <- n_distinct(aa_data$year, na.rm = TRUE)

#most recent year
years_max <- max(aa_data$year, na.rm = TRUE)

#average of last five years
mean_last_5yr <- get_mean(aa_data, year, (years_max-5):years_max)

#averge of first five years (2000-2005)
mean_first_5yr <- get_mean(aa_data, year, 2000:2005)

#average of second five years (2006-2010)
mean_second_5yr <- get_mean(aa_data, year, 2006:2010)

#April-August % of attacks
warm_months_pct <- get_pct(aa_data, month, month.abb[4:8])

#midday % of attacks
midday_pct <- get_pct(aa_data, hour, 12)

#late morning % of attacks
late_morn_pct <- get_pct(aa_data, hour, 8:11)

#early afternoon % of attacks
early_aft_pct <- get_pct(aa_data, hour, 13:16)

```

::: {.card .flow title="Attack Timing" expandable="false"}

The Active Attacks occur for a variety of reasons, sometimes they are planned 
and other times not. Here, we show the timing of Active Attacks from 2000 to 
`{r} years_max`, a critical element for premeditated attacks with the goal of 
maximizing casualties. As the plots demonstrate, some dimensions of time are 
more informative than others.  

**By Year**  
There appears to be more events in the last five years 
(mean = `{r} mean_last_5yr`) than the first five years 
(mean = `{r} mean_first_5yr`) or second five years 
(mean = `{r} mean_second_5yr`); however, this may be an artifact of media 
coverage. Events that occurred during the first part of this data collection 
period likely did not get the national coverage that they do now. Furthermore, 
technology and search engines have improved dramatically over the `{r} years` 
years of this data collection period.

**By Month**  
In contrast to the obvious upward trend in attacks across years, there appear 
to be only a modest trend related to months of the year. Active Attacks tend to 
peak during the warmer months of the year (e.g., April through August account 
for `{r} warm_months_pct`% of attacks), though this trend is not a strong one. 
The relationship with temperature is similar to trends observed for certain 
types of violent crime (e.g., aggravated assault, homicide) that also tend to 
peak during the warmest parts of the year.

**By Day of the Week**  
Active Attacks share no observable association with day of the week. This can 
be seen by the flat distribution of attacks across the week. So while 
there may be trends by year and month, attacks appear to be nearly equally 
likely on any given day of the week.

**By Hour of the Day**  
Active attacks tend to cluster around midday. While attacks that begin at 
midday exactly are relatively infrequent (only `{r} midday_pct`% of attacks), 
the majority of attacks occur immediately before midday (8-11am hours account 
for `{r} late_morn_pct`% of attacks) or after midday (1-4pm hours account for 
`{r} early_aft_pct`% of attacks).
:::

### row 1, column 2 {.tabset width="60%"}
::: {.card .flow title="By Year" expandable="true"}
![{{< downloadthis www/univar_yr.png dname="aa_by_year" >}}](www/univar_yr.png)
:::

::: {.card .flow title="By Month" expandable="true"}
![{{< downloadthis www/univar_month.png dname="aa_by_month" >}}](www/univar_month.png)  
:::

::: {.card .flow title="By Day of the Week" expandable="true"}
![{{< downloadthis www/univar_wday.png dname="aa_by_wday" >}}](www/univar_wday.png)
:::

::: {.card .flow title="By Hour of the Day" expandable="true"}
![{{< downloadthis www/univar_hr.png dname="aa_by_hour" >}}](www/univar_hr.png)
:::

# Attackers

## row 1 {height="50%"}

### row 1, column 1 {width="35%"}

```{r}

#male % of shooters (long data)
male_pct <- get_pct(aa_data_long, sex, "Male")

#male % of shooters
solo_pct <- get_pct(aa_data, offender_count, 1)

#Black % of shooters
black_pct <- get_pct(aa_data_long, race, "African American")

#White % of shooters
white_pct <- get_pct(aa_data_long, race, "Caucasian")

#other race % of shooters
other_pct <- 100 - black_pct - white_pct

#minimum age of shooters
age_min <- min(aa_data_long$age, na.rm = TRUE)

#maximum age of shooters
age_max <- max(aa_data_long$age, na.rm = TRUE)

#median age of shooters
age_median <- median(aa_data_long$age, na.rm = TRUE)

#non-gun % of attacks
non_gun_pct <- get_pct(aa_data, weapon_primary, c("Knife", "Vehicle"))

#pistol %
pistol_pct <- get_pct(aa_data, weapon_primary, "Pistol")

#Riffle %
rifle_pct <- get_pct(aa_data, weapon_primary, "Rifle")

#Shotgun %
shotgun_pct <- get_pct(aa_data, weapon_primary, "Shotgun")

```


::: {.card .flow title="Attackers" expandable="false"}
Many in the media attempt to create a profile describing the “average” attacker. 
The data do not support a profile beyond sex and number of attackers. Attackers
were male `{r} male_pct`% of the time. Furthermore, the 
attacker commits the attack by him/herself `{r} solo_pct`% of the time. 
Beyond these characteristics, attackers are somewhat more varied. 

**Attacker Race/Ethnicity**  
Most attackers were either Caucasian (`{r} white_pct`%) or African American 
`{r} black_pct`%). All other racial/ethnic groups (e.g., Latino, Asian, Middle 
Eastern) only accounted for around a quarter of attackers (`{r} other_pct`%). 

**Attacker Age**  
While the median age of attackers was `{r} age_median` years old, attackers ranged in age 
from `{r} age_min` to `{r} age_max`. Attackers in their twenties were the 
most plentiful group compared to any other decade of life. The age-trend of attackers 
adheres to the classic "age-crime curve" observed for nearly every crime type, 
peaking in late adolescence/early adulthood and steadily declining throughout 
the rest of the life course.

**Weapon Type**  
Active attacks can be carried out using any weapon though, in reality, only a 
very small minority of attacks (`{r} non_gun_pct`%) were carried out using weapons 
other than firearms (e.g., knife, vehicle). Among types of firearms, handguns 
made up a clear majority (`{r} pistol_pct`%), while rifles (e.g., AR15s) and 
shotguns were used in `{r} rifle_pct`% and `{r} shotgun_pct`% of the time, 
respectively.
:::

### row 1, column 2 {.tabset width="65%"}

::: {.card .fill title="Attacker Race/Ethnicity" expandable="true"}
![{{< downloadthis www/univar_race.png dname="aa_by_race" >}}](www/univar_race.png)
:::

::: {.card .fill title="Attacker Age" expandable="true"}
![{{< downloadthis www/univar_age.png dname="aa_by_age" >}}](www/univar_age.png)
:::


::: {.card .fill title="Weapon Type" expandable="true"}
![{{< downloadthis www/univar_weapon.png dname="aa_by_weapon" >}}](www/univar_weapon.png)
:::

# Locations

## row 1

### row 1, column 1 {width="35%"}

```{r, r_objs_loc}
#| include: false
#| echo: false

# Business %
business_pct <- get_pct(aa_data, location_primary, "Business")

# outdoor %
outdoors_pct <- get_pct(aa_data, location_primary, "Outdoors")

# School %
school_pct <- get_pct(aa_data, location_primary, "School")

# Other %
other_pct <- get_pct(aa_data, location_primary, "Other")

#get n's
# Business n
business_n <- get_count(aa_data, location_primary, "Business")

# outdoor n
outdoors_n <- get_count(aa_data, location_primary, "Outdoors")

# School n
school_n <- get_count(aa_data, location_primary, "School")

# Other n
other_n <- get_count(aa_data, location_primary, "Other")

```

::: {.card .flow title="Attack Location" expandable="false"}
For instance, on 
January 8, 2011 a shooter attacked a meeting for U.S. Representative Gabrielle 
Giffords. This attack happened in the parking lot of a local grocery store. Had 
the attack happened in the store it would have been classified as a business 
event; however, since the attack occurred in the parking lot it is coded as a 
public event.

**Location Type**  
As seen here, the plurality of events happen at places of business 
(`{r} business_pct`%). Places of business include factories/warehouse, retail 
locations, and office space. Around a quarter of attacks 
(`{r} outdoors_pct`%) happened in public (outdoor) spaces. Schools were 
attacked `{r} school_n` times (`{r} school_pct`%). These events are aggregated 
and include attacks on all types of educational facilities, including K-12 and 
institutes of higher education. Lastly, `{r} other_n` attacks 
(`{r} other_pct`%) happened at "Other" locations (e.g., houses of worship).

**Relationship to Location**  
Most attackers have no prior relationship with the attack location. 

**Location Type and Time of Day**  

:::

### row 1, column 2 {.tabset width="65%"}

::: {.card .flow title="Location Type" expandable="false"}
![{{< downloadthis www/univar_loc.png dname="aa_by_loc_type" >}}](www/univar_loc.png)  
:::

::: {.card .flow title="Relationship to Location" expandable="true"}
![{{< downloadthis www/univar_rel.png dname="aa_by_rel_type" >}}](www/univar_rel.png)
:::

::: {.card .flow title="Location Type & Time of Day" expandable="true"}
![{{< downloadthis www/bivar_loc_hr.png dname="aa_by_loc_type_hour" >}}](www/bivar_loc_hr.png)
:::

# Fatalities

## row 1

### row 1, column 1 {width="35%"}

```{r, r_objs_vic}
#| include: false
#| echo: false

injur_tot <- aa_data |> 
  drop_na(c(wound_tot,kill_tot)) |> 
  mutate(injur_tot = wound_tot+kill_tot) |> 
  summarise(injur_tot = sum(injur_tot)) |> 
  pull(injur_tot)

kill_tot <- aa_data |> 
  drop_na(kill_tot) |> 
  summarise(kill_tot = sum(kill_tot)) |> 
  pull(kill_tot)

wound_tot <- aa_data |> 
  drop_na(wound_tot) |> 
  summarise(wound_tot = sum(wound_tot)) |> 
  pull(wound_tot)

```

::: {.card .flow title="Victims" expandable="false"}
There were `{r} format_num(injur_tot)` people injured in active attacks. Of 
these, `{r} format_num(kill_tot)` people died. 

**Attacks vs. Fatalities**
As can be seen here, the number 
of deaths has been increasing along with the number of active attacks each year. 
There are some noticeable spikes in the number of death, corresponding to some 
of the more well-known attacks. For example:

-   2007: the shooting Virginia Tech resulted in (NUMBER) of deaths, accounting 
for (%) of active attack deaths that year
-   2009: Fort Hood
-   2012: Sandy Hook Elementary School, Newtown, Connecticut
-   2017: Las Vegas, Nevada

Of note, while the number of active attacks did not decrease during the 
COVID-19 pandemic, the lethality of attacks did decrease to less than half the 
number of any of the four years previous. In 2021, however, the number of 
attacks increased and the number of deaths returned to pre-pandemic levels.

**Fatalities per Attack**  
INTERACTIVE  

**Fatalities Across Weapon Type**  
INTERACTIVE
:::

### row 1, column 2 {.tabset width="65%"}

::: {.card .flow title="Attacks Vs. Fatalities by Year" expandable="true"}
![{{< downloadthis www/bivar_eventkilled.png dname="attack_killed_year" >}}](www/bivar_eventkilled.png)
:::

::: {.card .fill title="Fatalities per Attack" expandable="true"}
<iframe width ="100%" height="550" src="www/bivar_kill_year.html"></iframe>
{{< downloadthis www/bivar_kill_year.html dname="fatalities_year" >}}
:::

::: {.card .fill title="Fatalities Across Weapon Type" expandable="true"}
<iframe width ="100%" height="550" src="www/bivar_kill_weapon.html"></iframe>
{{< downloadthis www/bivar_kill_weapon.html dname="fatalities_weapon_type" >}}
:::

# Across the USA

## row 1 

### row 1, column 21 {width="40%"}

::: {.card .fill title="Attacks across the USA" expandable="true"}

**Attacks & Fatalities by State**  
Filler

**Attacks & Fatalities by Year**  
:::

### row 1 column 2 {.tabset width="60%"}

::: {.card .flow title="Attacks & Fatalities by State" expandable="true"}
<iframe width ="90%" height="600" src="www/bicol_map_attackxkilled.html"></iframe>
{{< downloadthis www/bicol_map_attackxkilled.png dname="aa_attack_fatalities_map" >}}
:::

::: {.card .flow title="Attacks & Fatalities by Year" expandable="true"}
![{{< downloadthis www/rolling_map.gif dname="aa_attacks_year_map" >}}](www/rolling_map.gif)
:::

# Download the Data

## row 1

### row 1, column 1 {width="35%"}

::: {.card .flow title="About the Data" expandable="false"}
It is the mission of the Research Ring at ALERRT to make the Active Attack 
Data as freely accessible as possible. Please feel free to explore the raw 
data in the window to the right or download as a .csv file using the 
download button below.  

The data set is organized so that each row corresponds to a
unique active attack. This means that some variables, like shooter 
characteristics, need some special handling. Because some attacks involved 
multiple shooters, variables like age, race/ethnicity, and sex, are given a special 
suffix (e.g., _1, _2, _3) that correspond to specific shooters. For an attack 
with only one shooter, the demographic variables ending in _2 and _3 will 
contain missing values. The suffixes were assigned randomly and should not be 
taken as an indication that individuals described by variables ending in _1 
were somehow more central to the attack than the other shooters involved.

{{< downloadthis data/aa_data_wide_nogeo_2023.csv dname="aa_data_2023" >}}
:::

### row 1, column 2 {width="65%"}

```{r}
datatable(aa_data, filter = "top")
```

