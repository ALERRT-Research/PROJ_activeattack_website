---
#title: "The Anatomy of Active Attacks in the USA, 2000-2023"
format: 
  dashboard: 
    orientation: rows
    scrolling: true
resources: 
  - "www/lib/"
---

# By The Numbers

**The Anatomy of Active Attacks in the USA, 2000-2023**  

```{r, packages_data_fns}
#| echo: false
#| include: false

#load packages
source("0_set_up.R")

#import data
aa_data <- import("data/aa_data_wide_nogeo_2023.rds", trust=TRUE)

```

## row 1

### row 1, column 1 {width="35%"}

```{r, r_objs_yr}
#| include: false
#| echo: false

mean_last_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year >= max(year) - 5) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)
  
mean_first_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year <= min(year) + 5) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)

mean_second_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year > (min(year) + 5) & (year <= (min(year) + 10))) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)

years <- n_distinct(aa_data$year, na.rm = TRUE)

years_max <- max(aa_data$year, na.rm = TRUE)

```

::: {.card .flow title="Attack Timing" expandable="false"}

The Active Attacks occur for a variety of reasons, sometimes they are planned 
and other times not. Here, we show the timing of Active Attacks, a critical 
element for premeditated attacks with the goal of maximizing casualties. As the 
plots demonstrate, some dimensions of time are more informative than others.  

**By Year**  
The graphic below represents the frequency of active attacks from 2000 to `{r} years_max`. There appears to be more events in the last five years (mean = `{r} mean_last_5yr`) than the first five years (mean = `{r} mean_first_5yr`) or second five years (mean = `{r} mean_second_5yr`); however, this may be an artifact of media coverage. Events that occurred during the first part of this data collection period likely did not get the national coverage that they do now. Furthermore, technology and search engines have improved dramatically over the `{r} years` years of this data collection period.

**By Month**  
In contrast to the obvious upward trend in attacks across years, there appear 
to be only a modest trend related to months of the year. Active Attacks tend to 
peak during the warming months of the year (e.g., April through August account 
for (!!!% APR_AUG!!!) of attacks), though
this trend is not a strong one. The relationship with temperature is similar to 
trends observed for certain types of violent crime (e.g., aggravated assault, 
homicide) that also tend to peak during the warmest parts of the year.

**By Day of the Week**  
Active Attacks share no observable association with day of the week. This can 
be seen by the flat distribution of attacks across the week. So while 
there may be trends by year and month, attacks appear to be equally likely on
any given day of the week.

**By Hour of the Day**  
Midday is the most common time for Active Attacks to occur. While attacks are 
reported as beginning at noon relatively infrequently, the majority of attacks 
reportedly occur immediately before/after the noon hour.
:::

### row 1, column 2 {.tabset width="65%"}
::: {.card .flow title="By Year" expandable="true"}
![{{< downloadthis www/univar_yr.png dname="aa_by_year" >}}](www/univar_yr.png)
:::

::: {.card .flow title="By Month" expandable="true"}
![{{< downloadthis www/univar_month.png dname="aa_by_month" >}}](www/univar_month.png)
:::

::: {.card .flow title="By Day of the Week" expandable="true"}
![{{< downloadthis www/univar_wday.png dname="aa_by_wday" >}}](www/univar_wday.png)
:::

::: {.card .flow title="By Hour of the Day" expandable="true"}
![{{< downloadthis www/univar_hr.png dname="aa_by_hour" >}}](www/univar_hr.png)
:::

## row 2

### row 2, column 1 {width="35%"}

::: {.card .flow title="Attackers" expandable="false"}
Many in the media attempt to create a profile describing the “average” attacker. 
The data do not support a profile beyond sex and number of attackers. Attackers
were male (!!!% MALE!!!) of the time. Furthermore, the 
attacker commits the attack by him/herself !!!REPORT % SOLO!!! of the time. 
Beyond these characteristics, attackers are fairly varied. 

**Attacker Race/Ethnicity**  
Most attackers were either Caucasian (!!!% WHITE) or African American 
(!!!% BLACK!!!). Other racial/ethnic groups (e.g., Latino, Asian, Middle 
Eastern) only accounted for (!!!% NOT_BW!!!). 

**Attacker Age**  
Attackers ranged in age from (!!!MIN AGE!!!) to (!!!MAX AGE!!!), but most 
attackers were in their early twenties. The age-trend of attackers adheres to
the classic "age-crime curve" observed for nearly every crime type, peaking in 
late adolescence/early adulthood and steadily declining throughout the rest of 
the life course.

**Weapon Type**
Active attacks can be carried out using any weapon though, in reality, only a 
very small minority of attacks (!!!% NON_GUN!!!) were carried out using weapons 
other than firearms (e.g., knife, vehicle). Among types of firearms, handguns 
made up a clear majority (!!!% PISTOL!!!), while rifles (e.g., AR15s) and 
shotguns were used in (!!!% RIFLE!!!) and (!!!% SHOTGUN!!!) of the time, 
respectively.

**Weapon Type And Fatalities**
NEED THIS PLOT
:::

### row 2, column 2 {.tabset width="65%"}

::: {.card .fill title="Attacker Race/Ethnicity" expandable="true"}
![{{< downloadthis www/univar_race.png dname="aa_by_race" >}}](www/univar_race.png)
:::

::: {.card .fill title="Attacker Age" expandable="true"}
![{{< downloadthis www/univar_age.png dname="aa_by_age" >}}](www/univar_age.png)
:::


::: {.card .fill title="Weapon Type" expandable="true"}
![{{< downloadthis www/univar_weapon.png dname="aa_by_weapon" >}}](www/univar_weapon.png)
:::

## row 3

### row 3, column 1 {width="35%"}

```{r, r_objs_loc}
#| include: false
#| echo: false

aa_data_loc <- aa_data |> 
  drop_na(location_primary) |> 
  count(loc = location_primary,
        tot = n()) |> 
  mutate(loc_pct = (n/tot)*100,
         loc_pct = round(loc_pct, 1))

#get percents
business_pct <- aa_data_loc |> 
  filter(loc=="Business") |> 
  pull(loc_pct)

outdoors_pct <- aa_data_loc |> 
  filter(loc=="Outdoors") |> 
  pull(loc_pct)

school_pct <- aa_data_loc |> 
  filter(loc=="School") |> 
  pull(loc_pct)

other_pct <- aa_data_loc |> 
  filter(loc=="Other") |> 
  pull(loc_pct)

#get n's
business_n <- aa_data_loc |> 
  filter(loc=="Business") |> 
  pull(n)

outdoors_n <- aa_data_loc |> 
  filter(loc=="Outdoors") |> 
  pull(n)

school_n <- aa_data_loc |> 
  filter(loc=="School") |> 
  pull(n)

other_n <- aa_data_loc |> 
  filter(loc=="Other") |> 
  pull(n)

```

::: {.card .flow title="Attack Location" expandable="false"}
**Location Type**  
As seen here, the plurality of events happen at places of business (`{r} business_pct`%). Places of business include factories/warehouse, retail locations, and office space. Around a quarter of attacks (`{r} outdoors_pct`%) happened in public (outdoor) spaces. For instance, on January 8, 2011 a shooter attacked a meeting for U.S. Representative Gabrielle Giffords. This attack happened in the parking lot of a local grocery store. Had the attack happened in the store it would have been classified as a business event; however, since the attack occurred in the parking lot it is coded as a public event.

Schools were attacked `{r} school_n` times (`{r} school_pct`%). These events are aggregated and include attacks on all types of educational facilities, including K-12 and institutes of higher education. Lastly, `{r} other_n` attacks (`{r} other_pct`%) happened at "Other" locations (e.g., houses of worship).

**Relationship to Location**  
Most attackers have no prior relationship with the attack location. 
ADD FACETED PLOT.

**Location Type and Time of Day**  
:::

### row 3, column 2 {.tabset width="65%"}

::: {.card .fill title="Location Type" expandable="false"}
![{{< downloadthis www/univar_loc.png dname="aa_by_loc_type" >}}](www/univar_loc.png)
:::

::: {.card .fill title="Relationship to Location" expandable="true"}
![{{< downloadthis www/univar_rel.png dname="aa_by_rel_type" >}}](www/univar_rel.png)
:::

::: {.card .fill title="Location Type & Time of Day" expandable="true"}
![{{< downloadthis www/bivar_loc_hr.png dname="aa_by_loc_type_hour" >}}](www/bivar_loc_hr.png)
:::

## row 4

### row 4, column 1 {width="35%"}

```{r, r_objs_vic}
#| include: false
#| echo: false

injur_tot <- aa_data |> 
  drop_na(c(wound_tot,kill_tot)) |> 
  mutate(injur_tot = wound_tot+kill_tot) |> 
  summarise(injur_tot = sum(injur_tot)) |> 
  pull(injur_tot)

kill_tot <- aa_data |> 
  drop_na(kill_tot) |> 
  summarise(kill_tot = sum(kill_tot)) |> 
  pull(kill_tot)

wound_tot <- aa_data |> 
  drop_na(wound_tot) |> 
  summarise(wound_tot = sum(wound_tot)) |> 
  pull(wound_tot)

```

::: {.card .flow title="Victims" expandable="false"}
There were `{r} format_num(injur_tot)` people injured in active attacks. Of these, `{r} format_num(kill_tot)` people died. As can be seen here, the number of deaths has been increasing along with the number of active attacks each year. There are some noticeable spikes in the number of death, corresponding to some of the more well-known attacks. For example:

-   2007: the shooting Virginia Tech resulted in (NUMBER) of deaths, accounting for (%) of active attack deaths that year
-   2009: Fort Hood
-   2012: Sandy Hook Elementary School, Newtown, Connecticut
-   2017: Las Vegas, Nevada

Of note, while the number of active attacks did not decrease during the COVID-19 pandemic, the lethality of attacks did decrease to less than half the number of any of the four years previous. In 2021, however, the number of attacks increased and the number of deaths returned to pre-pandemic levels.

**Top ten deadliest attacks**  

:::

### row 4, column 2 {.tabset width="65%"}

::: {.card .fill title="Number of Attacks vs. Fatalities" expandable="true"}
![{{< downloadthis www/bivar_eventkilled.png dname="aa_attacks_fatalities_year" >}}](www/bivar_eventkilled.png)
:::

::: {.card .fill title="Fatalities Per Attack" expandable="true"}
![{{< downloadthis www/bivar_kill_yr.png dname="aa_fatalities_year" >}}](www/bivar_kill_yr.png)
:::

# Across The USA

**Where Active Attacks Happen**

## row 1

### row 1, column 1 {width="35%"}

::: {.card .flow title="Victims" expandable="false"}
Filler content.
:::

### row 1, column 2 {height="21%" width="21%"}

```{r, r_objs_valueboxes}
#| include: false
#| echo: false

attacks_ca <- aa_data |> 
  filter(state=="CA") |> 
  summarise(n=n()) |> 
  pull(n)

attacks_tx <- aa_data |> 
  filter(state=="TX") |> 
  summarise(n=n()) |> 
  pull(n)

attacks_fl <- aa_data |> 
  filter(state=="FL") |> 
  summarise(n=n()) |> 
  pull(n)
```

```{r}
#| content: valuebox
#| title: "Most attacks: California"

list(icon="emoji-tear-fill",
     color="red",
     value=attacks_ca)

```

### row 1, column 3 {width="21%"}
```{r}
#| content: valuebox
#| title: "2nd most attacks: Texas"

list(icon="emoji-tear-fill",
     color="orange",
     value=attacks_tx)

```

### row 1, column 4 {width="21%"}
```{r}
#| content: valuebox
#| title: "3rd most attacks: Florida"

list(icon="emoji-tear-fill",
     color="yellow",
     value=attacks_fl)

```

## row 2

### row 2 column 1 {width="35%"}

::: {.card .flow title="About the Data" expandable="false"}
**Where attacks happen in the USA**
:::

### row 2 column 2 {.tabset width="65%"}

::: {.card .flow title="Attacks Vs. Fatalities" expandable="true"}
<iframe width ="90%" height="800" src="www/bicol_map_attackxkilled.html"></iframe>
{{< downloadthis www/bicol_map_attackxkilled.png dname="aa_attack_fatalities_map" >}}
:::

::: {.card .flow title="Attacks from 2000-2023" expandable="true"}
![{{< downloadthis www/rolling_map.gif dname="aa_attacks_year_map" >}}](www/rolling_map.gif)
:::

# Download the Data

## row 1

### row 1, column 1 {width="35%"}

::: {.card .flow title="About the Data" expandable="false"}
It is the mission of the Research Ring at ALERRT to make the Active Attack 
dataset as freely accessible as possible. Please feel free to explore the raw 
data in the window to the right or download as a .csv file using the 
download button below.  

The dataset is organized so that each row corresponds to a
unique active attack. This means that some variables, like shooter 
characteristics, need some special handling. Because some attacks involved 
multiple shooters, variables like age, race/ethnicity, and sex, are given a special 
suffix (e.g., _1, _2, _3) that correspond to specific shooters. For an attack 
with only one shooter, the demographic variables ending in _2 and _3 will 
contain missing values. The suffixes were assigned randomly and should not be 
taken as an indication that individuals described by variables ending in _1 
were somehow more central to the attack than the other shooters involved.

{{< downloadthis data/aa_data_wide_nogeo_2023.csv dname="aa_data_2023" >}}
:::

### row 1, column 2 {width="65%"}

```{r}
datatable(aa_data, filter = "top")
```

