---
title: "The Anatomy of Active Attacks in the USA, 2000-2023"
format: 
  dashboard: 
    orientation: rows
    scrolling: true
---

Below are several plots that help illustrate the characteristics of active attacks included in the full Active Attack dataset. These visualization were created using the version of the dataset that is available for download on the [Download the Data](5_download_the_data.qmd) page. We selected specific aspects of Active Attacks that we believe will help inform the public and law enforcement about the nature of active attacks. While these images are static, the [Dataviz Builder](4_build_your_own.qmd) page allows users to create their own graphics using aspects of the dataset that are of most interest to them. 

```{r, packages_data_fns}
#| echo: false
#| include: false

#install packages
library(pacman)
p_load(cowplot,
       plotly,
       rio,
       sf,
       tidyverse)

#import data
aa_data <- import("data/aa_data_clean_2023.rds")

```

## row 1 
### row 1, column 1 {width="35%"}

```{r, r_objs_yr}
#| include: false
#| echo: false

mean_last_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year >= max(year) - 5) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)
  
mean_first_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year <= min(year) + 5) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)

mean_second_5yr <- aa_data |> 
  drop_na(year) |> 
  group_by(year) |> 
  summarise(events=n()) |> 
  ungroup() |> 
  filter(year > (min(year) + 5) & (year <= (min(year) + 10))) |>
  summarise(events_mean = mean(events, na.rm = TRUE)) |> 
  pull(events_mean)

years <- n_distinct(aa_data$year, na.rm = TRUE)

years_max <- max(aa_data$year, na.rm = TRUE)

```

:::{.card title="Attack Frequency" expandable=false .flow}
The graphic below represents the frequency of active attacks from 2000 to `{r} years_max`. There appears to be more events in the last five years (mean = `{r} mean_last_5yr`) than the first five years (mean = `{r} mean_first_5yr`) or second five years (mean = `{r} mean_second_5yr`); however, this may be an artifact of media coverage. Events that occurred during the first part of this data collection period likely did not get the national coverage that they do now. Furthermore, technology and search engines have improved dramatically over the `{r} years` years of this data collection period.
:::


### row 1, column 2 {width="65%"}

![{{< downloadthis www/univar_yr.png >}}](www/univar_yr.png)


## row 2
### column 1 {width="35%"}

```{r, r_objs_hr}
#| include: false
#| echo: false

midday_pct <- aa_data |> 
  drop_na(hour_24hr) |> 
  mutate(hour = hour(hour_24hr)) |> 
  summarise(midday_pct = mean(hour>=7 & hour<=16)*100) |> 
  mutate(midday_pct = round(midday_pct, 2)) |> 
  pull(midday_pct)
```

:::{.card title="Time of Day" expandable=false .flow}
The bulk of attacks happen between the hours of 7:00 am and 4:00 pm (`{r} midday_pct`%). However, as the below graphic shows, attacks occur at all times of the day. 
:::

### row 1, column 2 {width="65%"}

![{{< downloadthis www/univar_hr.png >}}](www/univar_hr.png)

